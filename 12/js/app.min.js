"use strict";(()=>{const e=document.querySelector("#placement__img-map-wrapper-js"),t=()=>{const e=new google.maps.Map(document.getElementById("map"),{zoom:17,center:{lat:59.93899,lng:30.32145}});new google.maps.Marker({position:{lat:59.938628,lng:30.3238},map:e,icon:"img/map-marker.png"})};if(e){const n=document.createElement("div");n.setAttribute("id","map"),n.setAttribute("class","placement__map"),e.parentElement.replaceChild(n,e);const i=document.createElement("script");i.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdxiZ8JD-Awc3VOchAbkcA54-XHZJYkGY&callback=initMap",i.defer=!0,window.initMap=t,document.head.appendChild(i)}})(),(()=>{const e="ArrowLeft",t="ArrowRight",n=document.querySelector("#filter-panel__cost-title-js"),i=document.querySelector("#cost-min-js"),r=document.querySelector("#cost-max-js");if(n&&i&&r){const o=(e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild})('\n      <div class="filter-panel__cost-range">\n        <div class="filter-panel__cost-range-line">\n          <div\n            class="filter-panel__cost-point filter-panel__cost-point--min"\n            tabindex="0"\n            id="filter-panel__cost-point-min-js"\n          ></div>\n          <div\n            class="filter-panel__cost-point filter-panel__cost-point--max"\n            tabindex="0"\n            id="filter-panel__cost-point-max-js"\n          ></div>\n        </div>\n      </div>\n    '),s=o.querySelector(".filter-panel__cost-range-line"),l=o.querySelector("#filter-panel__cost-point-min-js"),a=o.querySelector("#filter-panel__cost-point-max-js"),c={MIN:{propName:"--min-percent",limitCostValue:0,limitPropValue:0,initPropValue:0,input:i,point:l},MAX:{propName:"--max-percent",limitCostValue:22059,limitPropValue:100,initPropValue:68,input:r,point:a}},p=e=>parseFloat(o.style.getPropertyValue(e.propName).split("%")[0]),u=e=>{const t=parseInt(e.input.value,10);return Number.isNaN(t)?e.limitPropValue:t/c.MAX.limitCostValue*c.MAX.limitPropValue},d=e=>{const t=p(e);return Math.round(c.MAX.limitCostValue*t/c.MAX.limitPropValue)},m=e=>{const t=d(e);parseFloat(e.input.value)!==t&&(e.input.value=t)},v=(e,t)=>{o.style.setProperty(e.propName,t+"%"),m(e)},_=(e,t)=>{(t=t||u(e))<c.MIN.limitPropValue?t=c.MIN.limitPropValue:t>c.MAX.limitPropValue&&(t=c.MAX.limitPropValue),e===c.MIN&&t>p(c.MAX)?v(c.MAX,t):e===c.MAX&&t<p(c.MIN)&&v(c.MIN,t),v(e,t)},L=e=>{e.target===c.MIN.input?_(c.MIN):_(c.MAX)},E=e=>{const t=e.target===c.MIN.point?c.MIN:c.MAX,n=s.clientWidth,i=s.getBoundingClientRect().left,r=e=>{const r=Math.round((e.x-i)/n*100);_(t,r)},o=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",o)},M=n=>{const i=n.target===c.MIN.point?c.MIN:c.MAX;n.code===e?_(i,p(i)-1):n.code===t&&_(i,p(i)+1)};v(c.MIN,c.MIN.initPropValue),v(c.MAX,c.MAX.initPropValue),i.addEventListener("input",L),r.addEventListener("input",L),l.addEventListener("mousedown",E),a.addEventListener("mousedown",E),l.addEventListener("keydown",M),a.addEventListener("keydown",M),n.after(o)}})(),(()=>{const e="popup--opened",t="popup--error",n=document.querySelector("#placement__description-button-js"),i=document.querySelector("#popup-js"),r=i.querySelector("#popup__form-js"),o=i.querySelector("#popup__close-button-js"),s=i.querySelector("#popup__submit-js"),l=i.querySelector("#popup-field-name-js"),a=i.querySelector("#popup-field-email-js"),c=i.querySelector("#popup-field-letter-js"),p={NAME:"userName",EMAIL:"userEmail"},u=t=>{t.preventDefault(),i.classList.add(e),l.value=localStorage.getItem(p.NAME),a.value=localStorage.getItem(p.EMAIL),o.addEventListener("click",d),s.addEventListener("click",m),l.addEventListener("input",L),a.addEventListener("input",L),c.addEventListener("input",L)},d=n=>{n&&n.preventDefault(),i.classList.remove(e),i.classList.remove(t),o.removeEventListener("click",d),s.removeEventListener("click",m),l.removeEventListener("input",L),a.removeEventListener("input",L),c.removeEventListener("input",L)},m=e=>{e.preventDefault(),i.classList.remove(t),_()&&fetch("https://echo.htmlacademy.ru/",{method:"POST",body:new FormData(r)}).then((e=>{if(!e.ok)throw i.classList.add(t),new Error(`_${e.status}: ${e.statusText}`);return localStorage.setItem(p.NAME,l.value),localStorage.setItem(p.EMAIL,a.value),l.value="",a.value="",c.value="",d(),e})).catch((e=>{throw i.classList.add(t),e}))},v=e=>e.value.length>0?(e.setCustomValidity(""),!0):(e.setCustomValidity("Обязательное поле для заполнения"),!1),_=()=>v(l)&&v(a)&&v(c),L=e=>{v(e.target)};i&&n&&o&&s&&(i.classList.remove("popup--no-js"),n.addEventListener("click",u))})(),(()=>{const e=document.querySelector(".principles");if(e){const t="principles__slide--active",n="principles__control-button--active",i=e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstChild},r=(r,o)=>{const s=i(`<li>\n          <button class="principles__control-button  ${o?"":n}" type="button">\n            <span class="visually-hidden">Принцип ${o+1}</span>\n          </button>\n        </li>`);return s.firstElementChild.addEventListener("click",(i=>{const o=e.querySelector("."+t);o!==r&&(e.querySelector("."+n).classList.remove(n),o.classList.remove(t),r.classList.add(t),i.target.classList.add(n))})),o||r.classList.add(t),s},o=e.querySelector("#principles__slider-js"),s=e.querySelectorAll(".principles__slide"),l=i('<ul class="principles__control list-reset"></ul>');s.forEach(((e,t)=>{e.classList.remove("principles__slide--no-js"),l.append(r(e,t))})),o.after(l)}})(),(()=>{const e=Array.from(document.querySelectorAll(".sort-panel__type")),t=Array.from(document.querySelectorAll(".sort-panel__direction")),n=n=>{const i=n.target;let r="",o=[];e.includes(i)?(r="sort-panel__type--active",o=e):(r="sort-panel__direction--active",o=t),o.filter((e=>e.classList.contains(r))).forEach((e=>e.classList.remove(r))),i.classList.add(r)};e.forEach((e=>e.addEventListener("click",n))),t.forEach((e=>e.addEventListener("click",n)))})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsIm11bHRpcGxlLXJhbmdlLmpzIiwicG9wdXAuanMiLCJzbGlkZXIuanMiLCJzb3J0LmpzIl0sIm5hbWVzIjpbIm1hcEltZ1dyYXBwZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbml0TWFwIiwibWFwIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsIk1hcmtlciIsInBvc2l0aW9uIiwiaWNvbiIsIm1hcENvbnRhaW5lciIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJwYXJlbnRFbGVtZW50IiwicmVwbGFjZUNoaWxkIiwic2NyaXB0Iiwic3JjIiwiZGVmZXIiLCJ3aW5kb3ciLCJoZWFkIiwiYXBwZW5kQ2hpbGQiLCJLZXlDb2RlIiwicHJldkVsZW1lbnQiLCJtaW5Db3N0IiwibWF4Q29zdCIsInJhbmdlQmxvY2siLCJ0ZW1wbGF0ZSIsIndyYXBwZXIiLCJpbm5lckhUTUwiLCJmaXJzdEVsZW1lbnRDaGlsZCIsInJhbmdlTGluZSIsInBvaW50TWluIiwicG9pbnRNYXgiLCJDb3N0T2JqIiwiTUlOIiwicHJvcE5hbWUiLCJsaW1pdENvc3RWYWx1ZSIsImxpbWl0UHJvcFZhbHVlIiwiaW5pdFByb3BWYWx1ZSIsImlucHV0IiwicG9pbnQiLCJNQVgiLCJnZXRDdXJyZW50UHJvcFZhbHVlIiwiY29zdE9iaiIsInBhcnNlRmxvYXQiLCJzdHlsZSIsImdldFByb3BlcnR5VmFsdWUiLCJzcGxpdCIsImNhbGN1bGF0ZVByb3BWYWx1ZSIsIm5ld0Nvc3RWYWx1ZSIsInBhcnNlSW50IiwidmFsdWUiLCJOdW1iZXIiLCJpc05hTiIsImNhbGN1bGF0ZUNvc3RWYWx1ZSIsImN1cnJlbnRQcm9wVmFsdWUiLCJNYXRoIiwicm91bmQiLCJjaGFuZ2VDb3N0VmFsdWUiLCJtYWtlU3luY2hyb25pemF0aW9uIiwibmV3UHJvcFZhbHVlIiwic2V0UHJvcGVydHkiLCJjaGFuZ2VQcm9wVmFsdWUiLCJvbkNoYW5nZUNvc3RWYWx1ZSIsImV2dCIsInRhcmdldCIsIm9uUG9pbnRNb3VzZURvd24iLCJkb3duRXZ0IiwibGluZVdpZHRoIiwiY2xpZW50V2lkdGgiLCJsZWZ0T2Zmc2V0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwibGVmdCIsIm9uTW92ZVBvaW50IiwibW91c2VFdnQiLCJ4Iiwib25VcFBvaW50IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJvblBvaW50S2V5RG93biIsImtleURvd25FdnQiLCJjb2RlIiwiYWZ0ZXIiLCJPUEVORURfQ0xBU1MiLCJFUlJPUl9DTEFTUyIsIm9wZW5Qb3B1cEJ0biIsInBvcHVwIiwicG9wdXBGb3JtIiwiY2xvc2VQb3B1cEJ0biIsInN1Ym1pdFBvcHVwRm9ybUJ0biIsIm5hbWVJbnB1dCIsImVtYWlsSW5wdXQiLCJsZXR0ZXJUZXh0YXJlYSIsIkxvY2FsU3RvcmFnZUtleSIsIk5BTUUiLCJFTUFJTCIsIm9wZW5Qb3B1cCIsInByZXZlbnREZWZhdWx0IiwiY2xhc3NMaXN0IiwiYWRkIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImNsb3NlUG9wdXAiLCJzdWJtaXRGb3JtIiwib25GaWVsZERhdGFDaGFuZ2VkIiwicmVtb3ZlIiwiaXNWYWxpZEZvcm1EYXRhIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiRm9ybURhdGEiLCJ0aGVuIiwicmVzcG9uc2UiLCJvayIsIkVycm9yIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsInNldEl0ZW0iLCJjYXRjaCIsImVycm9yIiwiaXNWYWxpZEZpZWxkIiwiZmllbGQiLCJsZW5ndGgiLCJzZXRDdXN0b21WYWxpZGl0eSIsInNsaWRlckNvbnRhaW5lciIsIlNMSURFX0FDVElWRV9DTEFTUyIsIkJVVFRPTl9BQ1RJVkVfQ0xBU1MiLCJuZXdFbGVtZW50IiwiZmlyc3RDaGlsZCIsImNyZWF0ZVNsaWRlckJ1dHRvbiIsInNsaWRlIiwibnVtYmVyIiwiYnV0dG9uV3JhcHBlciIsImN1cnJlbnRTbGlkZSIsImJlZm9yZUluc2VydEJsb2NrIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsImJ1dHRvbnNDb250YWluZXIiLCJmb3JFYWNoIiwiaW5kZXgiLCJhcHBlbmQiLCJzb3J0VHlwZUJ1dHRvbnMiLCJBcnJheSIsImZyb20iLCJzb3J0RGlyZWN0aW9uQnV0dG9ucyIsIm9uQnRuQ2xpY2siLCJzZWxlY3RlZEJ0biIsImFjdGl2ZUNsYXNzIiwiYnRucyIsImluY2x1ZGVzIiwiZmlsdGVyIiwiYnRuIiwiY29udGFpbnMiXSwibWFwcGluZ3MiOiJBQUFBLGFBRUEsTUFDQSxNQUFBQSxFQUFBQyxTQUFBQyxjQUFBLGtDQUVBQyxFQUFBLEtBRUEsTUFBQUMsRUFBQSxJQUFBQyxPQUFBQyxLQUFBQyxJQUFBTixTQUFBTyxlQUFBLE9BQUEsQ0FDQUMsS0FBQSxHQUNBQyxPQUFBLENBQ0FDLElBQUEsU0FDQUMsSUFBQSxZQUtBLElBQUFQLE9BQUFDLEtBQUFPLE9BQUEsQ0FDQUMsU0FBQSxDQUNBSCxJQUFBLFVBQ0FDLElBQUEsU0FFQVIsSUFBQUEsRUFDQVcsS0FBQSx3QkFJQSxHQUFBZixFQUFBLENBQ0EsTUFBQWdCLEVBQUFmLFNBQUFnQixjQUFBLE9BQ0FELEVBQUFFLGFBQUEsS0FBQSxPQUNBRixFQUFBRSxhQUFBLFFBQUEsa0JBQ0FsQixFQUFBbUIsY0FBQUMsYUFBQUosRUFBQWhCLEdBRUEsTUFBQXFCLEVBQUFwQixTQUFBZ0IsY0FBQSxVQUNBSSxFQUFBQyxJQUFBLHVHQUNBRCxFQUFBRSxPQUFBLEVBRUFDLE9BQUFyQixRQUFBQSxFQUVBRixTQUFBd0IsS0FBQUMsWUFBQUwsS0FwQ0EsR0NBQSxNQUNBLE1BQUFNLEVBQ0EsWUFEQUEsRUFFQSxhQUdBQyxFQUFBM0IsU0FBQUMsY0FBQSxnQ0FDQTJCLEVBQUE1QixTQUFBQyxjQUFBLGdCQUNBNEIsRUFBQTdCLFNBQUFDLGNBQUEsZ0JBU0EsR0FBQTBCLEdBQUFDLEdBQUFDLEVBQUEsQ0FDQSxNQWlCQUMsRUF6QkEs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cC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbigoKSA9PiB7XG4gIGNvbnN0IG1hcEltZ1dyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcGxhY2VtZW50X19pbWctbWFwLXdyYXBwZXItanNgKTtcblxuICBjb25zdCBpbml0TWFwID0gKCkgPT4ge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZlxuICAgIGNvbnN0IG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYG1hcGApLCB7XG4gICAgICB6b29tOiAxNyxcbiAgICAgIGNlbnRlcjoge1xuICAgICAgICBsYXQ6IDU5LjkzODk5MCxcbiAgICAgICAgbG5nOiAzMC4zMjE0NTAsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmLCBuby11bnVzZWQtdmFyc1xuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgbGF0OiA1OS45Mzg2MjgsXG4gICAgICAgIGxuZzogMzAuMzIzODAwLFxuICAgICAgfSxcbiAgICAgIG1hcCxcbiAgICAgIGljb246IGBpbWcvbWFwLW1hcmtlci5wbmdgLFxuICAgIH0pO1xuICB9O1xuXG4gIGlmIChtYXBJbWdXcmFwcGVyKSB7XG4gICAgY29uc3QgbWFwQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XG4gICAgbWFwQ29udGFpbmVyLnNldEF0dHJpYnV0ZShgaWRgLCBgbWFwYCk7XG4gICAgbWFwQ29udGFpbmVyLnNldEF0dHJpYnV0ZShgY2xhc3NgLCBgcGxhY2VtZW50X19tYXBgKTtcbiAgICBtYXBJbWdXcmFwcGVyLnBhcmVudEVsZW1lbnQucmVwbGFjZUNoaWxkKG1hcENvbnRhaW5lciwgbWFwSW1nV3JhcHBlcik7XG5cbiAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBzY3JpcHRgKTtcbiAgICBzY3JpcHQuc3JjID0gYGh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9qcz9rZXk9QUl6YVN5RGR4aVo4SkQtQXdjM1ZPY2hBYmtjQTU0LVhIWkpZa0dZJmNhbGxiYWNrPWluaXRNYXBgO1xuICAgIHNjcmlwdC5kZWZlciA9IHRydWU7XG5cbiAgICB3aW5kb3cuaW5pdE1hcCA9IGluaXRNYXA7XG5cbiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gIH1cbn0pKCk7XG4iLCIndXNlIHN0cmljdCc7XG5cbigoKSA9PiB7XG4gIGNvbnN0IEtleUNvZGUgPSB7XG4gICAgbGVmdDogYEFycm93TGVmdGAsXG4gICAgcmlnaHQ6IGBBcnJvd1JpZ2h0YCxcbiAgfTtcblxuICBjb25zdCBwcmV2RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNmaWx0ZXItcGFuZWxfX2Nvc3QtdGl0bGUtanNgKTtcbiAgY29uc3QgbWluQ29zdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjb3N0LW1pbi1qc2ApO1xuICBjb25zdCBtYXhDb3N0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2Nvc3QtbWF4LWpzYCk7XG5cbiAgY29uc3QgY3JlYXRlRWxlbWVudCA9ICh0ZW1wbGF0ZSkgPT4ge1xuICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBkaXZgKTtcbiAgICB3cmFwcGVyLmlubmVySFRNTCA9IHRlbXBsYXRlO1xuXG4gICAgcmV0dXJuIHdyYXBwZXIuZmlyc3RFbGVtZW50Q2hpbGQ7XG4gIH07XG5cbiAgaWYgKHByZXZFbGVtZW50ICYmIG1pbkNvc3QgJiYgbWF4Q29zdCkge1xuICAgIGNvbnN0IG1hcmt1cCA9IChgXG4gICAgICA8ZGl2IGNsYXNzPVwiZmlsdGVyLXBhbmVsX19jb3N0LXJhbmdlXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJmaWx0ZXItcGFuZWxfX2Nvc3QtcmFuZ2UtbGluZVwiPlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGNsYXNzPVwiZmlsdGVyLXBhbmVsX19jb3N0LXBvaW50IGZpbHRlci1wYW5lbF9fY29zdC1wb2ludC0tbWluXCJcbiAgICAgICAgICAgIHRhYmluZGV4PVwiMFwiXG4gICAgICAgICAgICBpZD1cImZpbHRlci1wYW5lbF9fY29zdC1wb2ludC1taW4tanNcIlxuICAgICAgICAgID48L2Rpdj5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBjbGFzcz1cImZpbHRlci1wYW5lbF9fY29zdC1wb2ludCBmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQtLW1heFwiXG4gICAgICAgICAgICB0YWJpbmRleD1cIjBcIlxuICAgICAgICAgICAgaWQ9XCJmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQtbWF4LWpzXCJcbiAgICAgICAgICA+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgYCk7XG5cbiAgICBjb25zdCByYW5nZUJsb2NrID0gY3JlYXRlRWxlbWVudChtYXJrdXApO1xuICAgIGNvbnN0IHJhbmdlTGluZSA9IHJhbmdlQmxvY2sucXVlcnlTZWxlY3RvcihgLmZpbHRlci1wYW5lbF9fY29zdC1yYW5nZS1saW5lYCk7XG4gICAgY29uc3QgcG9pbnRNaW4gPSByYW5nZUJsb2NrLnF1ZXJ5U2VsZWN0b3IoYCNmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQtbWluLWpzYCk7XG4gICAgY29uc3QgcG9pbnRNYXggPSByYW5nZUJsb2NrLnF1ZXJ5U2VsZWN0b3IoYCNmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQtbWF4LWpzYCk7XG5cbiAgICBjb25zdCBDb3N0T2JqID0ge1xuICAgICAgTUlOOiB7XG4gICAgICAgIHByb3BOYW1lOiBgLS1taW4tcGVyY2VudGAsXG4gICAgICAgIGxpbWl0Q29zdFZhbHVlOiAwLFxuICAgICAgICBsaW1pdFByb3BWYWx1ZTogMCxcbiAgICAgICAgaW5pdFByb3BWYWx1ZTogMCxcbiAgICAgICAgaW5wdXQ6IG1pbkNvc3QsXG4gICAgICAgIHBvaW50OiBwb2ludE1pbixcbiAgICAgIH0sXG4gICAgICBNQVg6IHtcbiAgICAgICAgcHJvcE5hbWU6IGAtLW1heC1wZXJjZW50YCxcbiAgICAgICAgbGltaXRDb3N0VmFsdWU6IDIyMDU5LFxuICAgICAgICBsaW1pdFByb3BWYWx1ZTogMTAwLFxuICAgICAgICBpbml0UHJvcFZhbHVlOiA2OCxcbiAgICAgICAgaW5wdXQ6IG1heENvc3QsXG4gICAgICAgIHBvaW50OiBwb2ludE1heCxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IGdldEN1cnJlbnRQcm9wVmFsdWUgPSAoY29zdE9iaikgPT4ge1xuICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoXG4gICAgICAgICAgcmFuZ2VCbG9jay5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKGNvc3RPYmoucHJvcE5hbWUpLnNwbGl0KGAlYClbMF1cbiAgICAgICk7XG4gICAgfTtcblxuICAgIGNvbnN0IGNhbGN1bGF0ZVByb3BWYWx1ZSA9IChjb3N0T2JqKSA9PiB7XG4gICAgICBjb25zdCBuZXdDb3N0VmFsdWUgPSBwYXJzZUludChjb3N0T2JqLmlucHV0LnZhbHVlLCAxMCk7XG5cbiAgICAgIGlmIChOdW1iZXIuaXNOYU4obmV3Q29zdFZhbHVlKSkge1xuICAgICAgICByZXR1cm4gY29zdE9iai5saW1pdFByb3BWYWx1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ld0Nvc3RWYWx1ZSAvIENvc3RPYmouTUFYLmxpbWl0Q29zdFZhbHVlICogQ29zdE9iai5NQVgubGltaXRQcm9wVmFsdWU7XG4gICAgfTtcblxuICAgIGNvbnN0IGNhbGN1bGF0ZUNvc3RWYWx1ZSA9IChjb3N0T2JqKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50UHJvcFZhbHVlID0gZ2V0Q3VycmVudFByb3BWYWx1ZShjb3N0T2JqKTtcblxuICAgICAgcmV0dXJuIE1hdGgucm91bmQoXG4gICAgICAgICAgQ29zdE9iai5NQVgubGltaXRDb3N0VmFsdWUgKiBjdXJyZW50UHJvcFZhbHVlIC8gQ29zdE9iai5NQVgubGltaXRQcm9wVmFsdWVcbiAgICAgICk7XG4gICAgfTtcblxuICAgIGNvbnN0IGNoYW5nZUNvc3RWYWx1ZSA9IChjb3N0T2JqKSA9PiB7XG4gICAgICBjb25zdCBuZXdDb3N0VmFsdWUgPSBjYWxjdWxhdGVDb3N0VmFsdWUoY29zdE9iaik7XG5cbiAgICAgIGlmIChwYXJzZUZsb2F0KGNvc3RPYmouaW5wdXQudmFsdWUpICE9PSBuZXdDb3N0VmFsdWUpIHtcbiAgICAgICAgY29zdE9iai5pbnB1dC52YWx1ZSA9IG5ld0Nvc3RWYWx1ZTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgbWFrZVN5bmNocm9uaXphdGlvbiA9IChjb3N0T2JqLCBuZXdQcm9wVmFsdWUpID0+IHtcbiAgICAgIHJhbmdlQmxvY2suc3R5bGUuc2V0UHJvcGVydHkoY29zdE9iai5wcm9wTmFtZSwgYCR7bmV3UHJvcFZhbHVlfSVgKTtcbiAgICAgIGNoYW5nZUNvc3RWYWx1ZShjb3N0T2JqKTtcbiAgICB9O1xuXG4gICAgY29uc3QgY2hhbmdlUHJvcFZhbHVlID0gKGNvc3RPYmosIG5ld1Byb3BWYWx1ZSkgPT4ge1xuICAgICAgbmV3UHJvcFZhbHVlID0gbmV3UHJvcFZhbHVlID8gbmV3UHJvcFZhbHVlIDogY2FsY3VsYXRlUHJvcFZhbHVlKGNvc3RPYmopO1xuXG4gICAgICBpZiAobmV3UHJvcFZhbHVlIDwgQ29zdE9iai5NSU4ubGltaXRQcm9wVmFsdWUpIHtcbiAgICAgICAgbmV3UHJvcFZhbHVlID0gQ29zdE9iai5NSU4ubGltaXRQcm9wVmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKG5ld1Byb3BWYWx1ZSA+IENvc3RPYmouTUFYLmxpbWl0UHJvcFZhbHVlKSB7XG4gICAgICAgIG5ld1Byb3BWYWx1ZSA9IENvc3RPYmouTUFYLmxpbWl0UHJvcFZhbHVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoY29zdE9iaiA9PT0gQ29zdE9iai5NSU4gJiYgbmV3UHJvcFZhbHVlID4gZ2V0Q3VycmVudFByb3BWYWx1ZShDb3N0T2JqLk1BWCkpIHtcbiAgICAgICAgbWFrZVN5bmNocm9uaXphdGlvbihDb3N0T2JqLk1BWCwgbmV3UHJvcFZhbHVlKTtcbiAgICAgIH0gZWxzZSBpZiAoY29zdE9iaiA9PT0gQ29zdE9iai5NQVggJiYgbmV3UHJvcFZhbHVlIDwgZ2V0Q3VycmVudFByb3BWYWx1ZShDb3N0T2JqLk1JTikpIHtcbiAgICAgICAgbWFrZVN5bmNocm9uaXphdGlvbihDb3N0T2JqLk1JTiwgbmV3UHJvcFZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgbWFrZVN5bmNocm9uaXphdGlvbihjb3N0T2JqLCBuZXdQcm9wVmFsdWUpO1xuICAgIH07XG5cbiAgICBjb25zdCBvbkNoYW5nZUNvc3RWYWx1ZSA9IChldnQpID0+IHtcbiAgICAgIGlmIChldnQudGFyZ2V0ID09PSBDb3N0T2JqLk1JTi5pbnB1dCkge1xuICAgICAgICBjaGFuZ2VQcm9wVmFsdWUoQ29zdE9iai5NSU4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2hhbmdlUHJvcFZhbHVlKENvc3RPYmouTUFYKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3Qgb25Qb2ludE1vdXNlRG93biA9IChkb3duRXZ0KSA9PiB7XG4gICAgICBjb25zdCBjb3N0T2JqID0gZG93bkV2dC50YXJnZXQgPT09IENvc3RPYmouTUlOLnBvaW50XG4gICAgICAgID8gQ29zdE9iai5NSU5cbiAgICAgICAgOiBDb3N0T2JqLk1BWDtcbiAgICAgIGNvbnN0IGxpbmVXaWR0aCA9IHJhbmdlTGluZS5jbGllbnRXaWR0aDtcbiAgICAgIGNvbnN0IGxlZnRPZmZzZXQgPSByYW5nZUxpbmUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcblxuICAgICAgY29uc3Qgb25Nb3ZlUG9pbnQgPSAobW91c2VFdnQpID0+IHtcbiAgICAgICAgY29uc3QgbmV3UHJvcFZhbHVlID0gTWF0aC5yb3VuZCgobW91c2VFdnQueCAtIGxlZnRPZmZzZXQpIC8gbGluZVdpZHRoICogMTAwKTtcblxuICAgICAgICBjaGFuZ2VQcm9wVmFsdWUoY29zdE9iaiwgbmV3UHJvcFZhbHVlKTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG9uVXBQb2ludCA9ICgpID0+IHtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihgbW91c2Vtb3ZlYCwgb25Nb3ZlUG9pbnQpO1xuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGBtb3VzZXVwYCwgb25VcFBvaW50KTtcbiAgICAgIH07XG5cbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoYG1vdXNlbW92ZWAsIG9uTW92ZVBvaW50KTtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoYG1vdXNldXBgLCBvblVwUG9pbnQpO1xuICAgIH07XG5cbiAgICBjb25zdCBvblBvaW50S2V5RG93biA9IChrZXlEb3duRXZ0KSA9PiB7XG4gICAgICBjb25zdCBjb3N0T2JqID0ga2V5RG93bkV2dC50YXJnZXQgPT09IENvc3RPYmouTUlOLnBvaW50XG4gICAgICAgID8gQ29zdE9iai5NSU5cbiAgICAgICAgOiBDb3N0T2JqLk1BWDtcblxuICAgICAgaWYgKGtleURvd25FdnQuY29kZSA9PT0gS2V5Q29kZS5sZWZ0KSB7XG4gICAgICAgIGNoYW5nZVByb3BWYWx1ZShjb3N0T2JqLCBnZXRDdXJyZW50UHJvcFZhbHVlKGNvc3RPYmopIC0gMSk7XG4gICAgICB9IGVsc2UgaWYgKGtleURvd25FdnQuY29kZSA9PT0gS2V5Q29kZS5yaWdodCkge1xuICAgICAgICBjaGFuZ2VQcm9wVmFsdWUoY29zdE9iaiwgZ2V0Q3VycmVudFByb3BWYWx1ZShjb3N0T2JqKSArIDEpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBtYWtlU3luY2hyb25pemF0aW9uKENvc3RPYmouTUlOLCBDb3N0T2JqLk1JTi5pbml0UHJvcFZhbHVlKTtcbiAgICBtYWtlU3luY2hyb25pemF0aW9uKENvc3RPYmouTUFYLCBDb3N0T2JqLk1BWC5pbml0UHJvcFZhbHVlKTtcblxuICAgIG1pbkNvc3QuYWRkRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCBvbkNoYW5nZUNvc3RWYWx1ZSk7XG4gICAgbWF4Q29zdC5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsIG9uQ2hhbmdlQ29zdFZhbHVlKTtcblxuICAgIHBvaW50TWluLmFkZEV2ZW50TGlzdGVuZXIoYG1vdXNlZG93bmAsIG9uUG9pbnRNb3VzZURvd24pO1xuICAgIHBvaW50TWF4LmFkZEV2ZW50TGlzdGVuZXIoYG1vdXNlZG93bmAsIG9uUG9pbnRNb3VzZURvd24pO1xuXG4gICAgcG9pbnRNaW4uYWRkRXZlbnRMaXN0ZW5lcihga2V5ZG93bmAsIG9uUG9pbnRLZXlEb3duKTtcbiAgICBwb2ludE1heC5hZGRFdmVudExpc3RlbmVyKGBrZXlkb3duYCwgb25Qb2ludEtleURvd24pO1xuXG4gICAgcHJldkVsZW1lbnQuYWZ0ZXIocmFuZ2VCbG9jayk7XG4gIH1cbn0pKCk7XG4iLCIndXNlIHN0cmljdCc7XG5cbigoKSA9PiB7XG4gIGNvbnN0IE9QRU5FRF9DTEFTUyA9IGBwb3B1cC0tb3BlbmVkYDtcbiAgY29uc3QgTk9fSlNfQ0xBU1MgPSBgcG9wdXAtLW5vLWpzYDtcbiAgY29uc3QgRVJST1JfQ0xBU1MgPSBgcG9wdXAtLWVycm9yYDtcbiAgY29uc3QgRVJST1JfTUVTU0FHRSA9IGDQntCx0Y/Qt9Cw0YLQtdC70YzQvdC+0LUg0L/QvtC70LUg0LTQu9GPINC30LDQv9C+0LvQvdC10L3QuNGPYDtcbiAgY29uc3QgVVJMID0gYGh0dHBzOi8vZWNoby5odG1sYWNhZGVteS5ydS9gO1xuXG4gIGNvbnN0IG9wZW5Qb3B1cEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGFjZW1lbnRfX2Rlc2NyaXB0aW9uLWJ1dHRvbi1qc2ApO1xuICBjb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwb3B1cC1qc2ApO1xuICBjb25zdCBwb3B1cEZvcm0gPSBwb3B1cC5xdWVyeVNlbGVjdG9yKGAjcG9wdXBfX2Zvcm0tanNgKTtcbiAgY29uc3QgY2xvc2VQb3B1cEJ0biA9IHBvcHVwLnF1ZXJ5U2VsZWN0b3IoYCNwb3B1cF9fY2xvc2UtYnV0dG9uLWpzYCk7XG4gIGNvbnN0IHN1Ym1pdFBvcHVwRm9ybUJ0biA9IHBvcHVwLnF1ZXJ5U2VsZWN0b3IoYCNwb3B1cF9fc3VibWl0LWpzYCk7XG4gIGNvbnN0IG5hbWVJbnB1dCA9IHBvcHVwLnF1ZXJ5U2VsZWN0b3IoYCNwb3B1cC1maWVsZC1uYW1lLWpzYCk7XG4gIGNvbnN0IGVtYWlsSW5wdXQgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKGAjcG9wdXAtZmllbGQtZW1haWwtanNgKTtcbiAgY29uc3QgbGV0dGVyVGV4dGFyZWEgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKGAjcG9wdXAtZmllbGQtbGV0dGVyLWpzYCk7XG5cbiAgY29uc3QgTG9jYWxTdG9yYWdlS2V5ID0ge1xuICAgIE5BTUU6IGB1c2VyTmFtZWAsXG4gICAgRU1BSUw6IGB1c2VyRW1haWxgLFxuICB9O1xuXG4gIGNvbnN0IG9wZW5Qb3B1cCA9IChldnQpID0+IHtcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoT1BFTkVEX0NMQVNTKTtcblxuICAgIG5hbWVJbnB1dC52YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKExvY2FsU3RvcmFnZUtleS5OQU1FKTtcbiAgICBlbWFpbElucHV0LnZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oTG9jYWxTdG9yYWdlS2V5LkVNQUlMKTtcblxuICAgIGNsb3NlUG9wdXBCdG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBjbG9zZVBvcHVwKTtcbiAgICBzdWJtaXRQb3B1cEZvcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBzdWJtaXRGb3JtKTtcbiAgICBuYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCBvbkZpZWxkRGF0YUNoYW5nZWQpO1xuICAgIGVtYWlsSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCBvbkZpZWxkRGF0YUNoYW5nZWQpO1xuICAgIGxldHRlclRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoYGlucHV0YCwgb25GaWVsZERhdGFDaGFuZ2VkKTtcbiAgfTtcblxuICBjb25zdCBjbG9zZVBvcHVwID0gKGV2dCkgPT4ge1xuICAgIGlmIChldnQpIHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoT1BFTkVEX0NMQVNTKTtcbiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKEVSUk9SX0NMQVNTKTtcblxuICAgIGNsb3NlUG9wdXBCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBjbG9zZVBvcHVwKTtcbiAgICBzdWJtaXRQb3B1cEZvcm1CdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBzdWJtaXRGb3JtKTtcbiAgICBuYW1lSW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCBvbkZpZWxkRGF0YUNoYW5nZWQpO1xuICAgIGVtYWlsSW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCBvbkZpZWxkRGF0YUNoYW5nZWQpO1xuICAgIGxldHRlclRleHRhcmVhLnJlbW92ZUV2ZW50TGlzdGVuZXIoYGlucHV0YCwgb25GaWVsZERhdGFDaGFuZ2VkKTtcbiAgfTtcblxuICBjb25zdCBjbGVhclBvcHVwID0gKCkgPT4ge1xuICAgIG5hbWVJbnB1dC52YWx1ZSA9IGBgO1xuICAgIGVtYWlsSW5wdXQudmFsdWUgPSBgYDtcbiAgICBsZXR0ZXJUZXh0YXJlYS52YWx1ZSA9IGBgO1xuICB9O1xuXG4gIGNvbnN0IHN1Ym1pdEZvcm0gPSAoZXZ0KSA9PiB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKEVSUk9SX0NMQVNTKTtcblxuICAgIGlmIChpc1ZhbGlkRm9ybURhdGEoKSkge1xuICAgICAgZmV0Y2goVVJMLCB7XG4gICAgICAgIG1ldGhvZDogYFBPU1RgLFxuICAgICAgICBib2R5OiBuZXcgRm9ybURhdGEocG9wdXBGb3JtKSxcbiAgICAgIH0pXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoRVJST1JfQ0xBU1MpO1xuXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYF8ke3Jlc3BvbnNlLnN0YXR1c306ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShMb2NhbFN0b3JhZ2VLZXkuTkFNRSwgbmFtZUlucHV0LnZhbHVlKTtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShMb2NhbFN0b3JhZ2VLZXkuRU1BSUwsIGVtYWlsSW5wdXQudmFsdWUpO1xuXG4gICAgICAgICAgY2xlYXJQb3B1cCgpO1xuICAgICAgICAgIGNsb3NlUG9wdXAoKTtcblxuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoRVJST1JfQ0xBU1MpO1xuXG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBpc1ZhbGlkRmllbGQgPSAoZmllbGQpID0+IHtcbiAgICBpZiAoZmllbGQudmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgZmllbGQuc2V0Q3VzdG9tVmFsaWRpdHkoYGApO1xuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBmaWVsZC5zZXRDdXN0b21WYWxpZGl0eShFUlJPUl9NRVNTQUdFKTtcblxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCBpc1ZhbGlkRm9ybURhdGEgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGlzVmFsaWRGaWVsZChuYW1lSW5wdXQpXG4gICAgICAmJiBpc1ZhbGlkRmllbGQoZW1haWxJbnB1dClcbiAgICAgICYmIGlzVmFsaWRGaWVsZChsZXR0ZXJUZXh0YXJlYSk7XG4gIH07XG5cbiAgY29uc3Qgb25GaWVsZERhdGFDaGFuZ2VkID0gKGV2dCkgPT4ge1xuICAgIGlzVmFsaWRGaWVsZChldnQudGFyZ2V0KTtcbiAgfTtcblxuICBpZiAocG9wdXAgJiYgb3BlblBvcHVwQnRuICYmIGNsb3NlUG9wdXBCdG4gJiYgc3VibWl0UG9wdXBGb3JtQnRuKSB7XG4gICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShOT19KU19DTEFTUyk7XG4gICAgb3BlblBvcHVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgb3BlblBvcHVwKTtcbiAgfVxufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuKCgpID0+IHtcbiAgY29uc3Qgc2xpZGVyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLnByaW5jaXBsZXNgKTtcblxuICBpZiAoc2xpZGVyQ29udGFpbmVyKSB7XG4gICAgY29uc3QgU0xJREVfQUNUSVZFX0NMQVNTID0gYHByaW5jaXBsZXNfX3NsaWRlLS1hY3RpdmVgO1xuICAgIGNvbnN0IEJVVFRPTl9BQ1RJVkVfQ0xBU1MgPSBgcHJpbmNpcGxlc19fY29udHJvbC1idXR0b24tLWFjdGl2ZWA7XG5cbiAgICBjb25zdCBjcmVhdGVFbGVtZW50ID0gKHRlbXBsYXRlKSA9PiB7XG4gICAgICBjb25zdCBuZXdFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XG4gICAgICBuZXdFbGVtZW50LmlubmVySFRNTCA9IHRlbXBsYXRlO1xuXG4gICAgICByZXR1cm4gbmV3RWxlbWVudC5maXJzdENoaWxkO1xuICAgIH07XG5cbiAgICBjb25zdCBjcmVhdGVTbGlkZXJCdXR0b24gPSAoc2xpZGUsIG51bWJlcikgPT4ge1xuICAgICAgY29uc3QgYnV0dG9uVGVtcGxhdGUgPSAoXG4gICAgICAgIGA8bGk+XG4gICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInByaW5jaXBsZXNfX2NvbnRyb2wtYnV0dG9uICAke251bWJlciA/IGBgIDogQlVUVE9OX0FDVElWRV9DTEFTU31cIiB0eXBlPVwiYnV0dG9uXCI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cInZpc3VhbGx5LWhpZGRlblwiPtCf0YDQuNC90YbQuNC/ICR7bnVtYmVyICsgMX08L3NwYW4+XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvbGk+YFxuICAgICAgKTtcblxuICAgICAgY29uc3QgYnV0dG9uV3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoYnV0dG9uVGVtcGxhdGUpO1xuICAgICAgYnV0dG9uV3JhcHBlci5maXJzdEVsZW1lbnRDaGlsZC5hZGRFdmVudExpc3RlbmVyKGBjbGlja2AsIChldnQpID0+IHtcbiAgICAgICAgY29uc3QgY3VycmVudFNsaWRlID0gc2xpZGVyQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYC4ke1NMSURFX0FDVElWRV9DTEFTU31gKTtcblxuICAgICAgICBpZiAoY3VycmVudFNsaWRlICE9PSBzbGlkZSkge1xuICAgICAgICAgIHNsaWRlckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKGAuJHtCVVRUT05fQUNUSVZFX0NMQVNTfWApXG4gICAgICAgICAgICAuY2xhc3NMaXN0LnJlbW92ZShCVVRUT05fQUNUSVZFX0NMQVNTKTtcbiAgICAgICAgICBjdXJyZW50U2xpZGUuY2xhc3NMaXN0LnJlbW92ZShTTElERV9BQ1RJVkVfQ0xBU1MpO1xuXG4gICAgICAgICAgc2xpZGUuY2xhc3NMaXN0LmFkZChTTElERV9BQ1RJVkVfQ0xBU1MpO1xuICAgICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmFkZChCVVRUT05fQUNUSVZFX0NMQVNTKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmICghbnVtYmVyKSB7XG4gICAgICAgIHNsaWRlLmNsYXNzTGlzdC5hZGQoU0xJREVfQUNUSVZFX0NMQVNTKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGJ1dHRvbldyYXBwZXI7XG4gICAgfTtcblxuICAgIGNvbnN0IGJlZm9yZUluc2VydEJsb2NrID0gc2xpZGVyQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYCNwcmluY2lwbGVzX19zbGlkZXItanNgKTtcbiAgICBjb25zdCBzbGlkZXMgPSBzbGlkZXJDb250YWluZXIucXVlcnlTZWxlY3RvckFsbChgLnByaW5jaXBsZXNfX3NsaWRlYCk7XG5cbiAgICBjb25zdCBidXR0b25zQ29udGFpbmVyID0gY3JlYXRlRWxlbWVudChgPHVsIGNsYXNzPVwicHJpbmNpcGxlc19fY29udHJvbCBsaXN0LXJlc2V0XCI+PC91bD5gKTtcblxuICAgIHNsaWRlcy5mb3JFYWNoKChzbGlkZSwgaW5kZXgpID0+IHtcbiAgICAgIHNsaWRlLmNsYXNzTGlzdC5yZW1vdmUoYHByaW5jaXBsZXNfX3NsaWRlLS1uby1qc2ApO1xuXG4gICAgICBidXR0b25zQ29udGFpbmVyLmFwcGVuZChjcmVhdGVTbGlkZXJCdXR0b24oc2xpZGUsIGluZGV4KSk7XG4gICAgfSk7XG5cblxuICAgIGJlZm9yZUluc2VydEJsb2NrLmFmdGVyKGJ1dHRvbnNDb250YWluZXIpO1xuICB9XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oKCkgPT4ge1xuICBjb25zdCBBQ1RJVkVfU09SVF9UWVBFX0NMQVNTID0gYHNvcnQtcGFuZWxfX3R5cGUtLWFjdGl2ZWA7XG4gIGNvbnN0IEFDVElWRV9TT1JUX0RJUkVDVElPTl9DTEFTUyA9IGBzb3J0LXBhbmVsX19kaXJlY3Rpb24tLWFjdGl2ZWA7XG5cbiAgY29uc3Qgc29ydFR5cGVCdXR0b25zID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAuc29ydC1wYW5lbF9fdHlwZWApKTtcbiAgY29uc3Qgc29ydERpcmVjdGlvbkJ1dHRvbnMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC5zb3J0LXBhbmVsX19kaXJlY3Rpb25gKSk7XG5cbiAgY29uc3Qgb25CdG5DbGljayA9IChldnQpID0+IHtcbiAgICBjb25zdCBzZWxlY3RlZEJ0biA9IGV2dC50YXJnZXQ7XG4gICAgbGV0IGFjdGl2ZUNsYXNzID0gYGA7XG4gICAgbGV0IGJ0bnMgPSBbXTtcblxuICAgIGlmIChzb3J0VHlwZUJ1dHRvbnMuaW5jbHVkZXMoc2VsZWN0ZWRCdG4pKSB7XG4gICAgICBhY3RpdmVDbGFzcyA9IEFDVElWRV9TT1JUX1RZUEVfQ0xBU1M7XG4gICAgICBidG5zID0gc29ydFR5cGVCdXR0b25zO1xuICAgIH0gZWxzZSB7XG4gICAgICBhY3RpdmVDbGFzcyA9IEFDVElWRV9TT1JUX0RJUkVDVElPTl9DTEFTUztcbiAgICAgIGJ0bnMgPSBzb3J0RGlyZWN0aW9uQnV0dG9ucztcbiAgICB9XG5cbiAgICBidG5zXG4gICAgICAuZmlsdGVyKChidG4pID0+IGJ0bi5jbGFzc0xpc3QuY29udGFpbnMoYWN0aXZlQ2xhc3MpKVxuICAgICAgLmZvckVhY2goKGJ0bikgPT4gYnRuLmNsYXNzTGlzdC5yZW1vdmUoYWN0aXZlQ2xhc3MpKTtcblxuICAgIHNlbGVjdGVkQnRuLmNsYXNzTGlzdC5hZGQoYWN0aXZlQ2xhc3MpO1xuICB9O1xuXG4gIHNvcnRUeXBlQnV0dG9ucy5mb3JFYWNoKChidG4pID0+IGJ0bi5hZGRFdmVudExpc3RlbmVyKGBjbGlja2AsIG9uQnRuQ2xpY2spKTtcbiAgc29ydERpcmVjdGlvbkJ1dHRvbnMuZm9yRWFjaCgoYnRuKSA9PiBidG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBvbkJ0bkNsaWNrKSk7XG59KSgpO1xuIl19
