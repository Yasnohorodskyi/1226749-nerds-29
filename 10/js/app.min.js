"use strict";(()=>{const e=document.querySelector("#placement__img-map-wrapper-js"),t=()=>{const e=new google.maps.Map(document.getElementById("map"),{zoom:17,center:{lat:59.93899,lng:30.32145}});new google.maps.Marker({position:{lat:59.938628,lng:30.3238},map:e,icon:"/img/map-marker.png"})};if(e){const n=document.createElement("div");n.setAttribute("id","map"),n.setAttribute("class","placement__map"),e.parentElement.replaceChild(n,e);const i=document.createElement("script");i.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdxiZ8JD-Awc3VOchAbkcA54-XHZJYkGY&callback=initMap",i.defer=!0,window.initMap=t,document.head.appendChild(i)}})(),(()=>{const e="ArrowLeft",t="ArrowRight",n=document.querySelector("#filter-panel__cost-title-js"),i=document.querySelector("#cost-min-js"),r=document.querySelector("#cost-max-js");if(n&&i&&r){const o=(e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild})('\n      <div class="filter-panel__cost-range">\n        <div class="filter-panel__cost-range-line">\n          <div\n            class="filter-panel__cost-point filter-panel__cost-point--min"\n            tabindex="0"\n            id="filter-panel__cost-point-min-js"\n          ></div>\n          <div\n            class="filter-panel__cost-point filter-panel__cost-point--max"\n            tabindex="0"\n            id="filter-panel__cost-point-max-js"\n          ></div>\n        </div>\n      </div>\n    '),s=o.querySelector(".filter-panel__cost-range-line"),l=o.querySelector("#filter-panel__cost-point-min-js"),a=o.querySelector("#filter-panel__cost-point-max-js"),c={MIN:{propName:"--min-percent",limitCostValue:0,limitPropValue:0,initPropValue:0,input:i,point:l},MAX:{propName:"--max-percent",limitCostValue:22059,limitPropValue:100,initPropValue:68,input:r,point:a}},p=e=>parseFloat(o.style.getPropertyValue(e.propName).split("%")[0]),u=e=>{const t=parseInt(e.input.value,10);return Number.isNaN(t)?e.limitPropValue:t/c.MAX.limitCostValue*c.MAX.limitPropValue},d=e=>{const t=p(e);return Math.round(c.MAX.limitCostValue*t/c.MAX.limitPropValue)},m=e=>{const t=d(e);parseFloat(e.input.value)!==t&&(e.input.value=t)},v=(e,t)=>{o.style.setProperty(e.propName,t+"%"),m(e)},_=(e,t)=>{(t=t||u(e))<c.MIN.limitPropValue?t=c.MIN.limitPropValue:t>c.MAX.limitPropValue&&(t=c.MAX.limitPropValue),e===c.MIN&&t>p(c.MAX)?v(c.MAX,t):e===c.MAX&&t<p(c.MIN)&&v(c.MIN,t),v(e,t)},L=e=>{e.target===c.MIN.input?_(c.MIN):_(c.MAX)},E=e=>{const t=e.target===c.MIN.point?c.MIN:c.MAX,n=s.clientWidth,i=s.getBoundingClientRect().left,r=e=>{const r=Math.round((e.x-i)/n*100);_(t,r)},o=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",o)},M=n=>{const i=n.target===c.MIN.point?c.MIN:c.MAX;n.code===e?_(i,p(i)-1):n.code===t&&_(i,p(i)+1)};v(c.MIN,c.MIN.initPropValue),v(c.MAX,c.MAX.initPropValue),i.addEventListener("input",L),r.addEventListener("input",L),l.addEventListener("mousedown",E),a.addEventListener("mousedown",E),l.addEventListener("keydown",M),a.addEventListener("keydown",M),n.after(o)}})(),(()=>{const e="popup--opened",t="popup--error",n=document.querySelector("#placement__description-button-js"),i=document.querySelector("#popup-js"),r=i.querySelector("#popup__form-js"),o=i.querySelector("#popup__close-button-js"),s=i.querySelector("#popup__submit-js"),l=i.querySelector("#popup-field-name-js"),a=i.querySelector("#popup-field-email-js"),c=i.querySelector("#popup-field-letter-js"),p={NAME:"userName",EMAIL:"userEmail"},u=t=>{t.preventDefault(),i.classList.add(e),l.value=localStorage.getItem(p.NAME),a.value=localStorage.getItem(p.EMAIL),o.addEventListener("click",d),s.addEventListener("click",m),l.addEventListener("input",L),a.addEventListener("input",L),c.addEventListener("input",L)},d=n=>{n&&n.preventDefault(),i.classList.remove(e),i.classList.remove(t),o.removeEventListener("click",d),s.removeEventListener("click",m),l.removeEventListener("input",L),a.removeEventListener("input",L),c.removeEventListener("input",L)},m=e=>{e.preventDefault(),i.classList.remove(t),_()&&fetch("https://echo.htmlacademy.ru/",{method:"POST",body:new FormData(r)}).then((e=>{if(!e.ok)throw i.classList.add(t),new Error(`_${e.status}: ${e.statusText}`);return localStorage.setItem(p.NAME,l.value),localStorage.setItem(p.EMAIL,a.value),l.value="",a.value="",c.value="",d(),e})).catch((e=>{throw i.classList.add(t),e}))},v=e=>e.value.length>0?(e.setCustomValidity(""),!0):(e.setCustomValidity("Обязательное поле для заполнения"),!1),_=()=>v(l)&&v(a)&&v(c),L=e=>{v(e.target)};i&&n&&o&&s&&(i.classList.remove("popup--no-js"),n.addEventListener("click",u))})(),(()=>{const e=document.querySelector(".principles");if(e){const t="principles__slide--active",n="principles__control-button--active",i=e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstChild},r=(r,o)=>{const s=i(`<li>\n          <button class="principles__control-button  ${o?"":n}" type="button">\n            <span class="visually-hidden">Принцип ${o+1}</span>\n          </button>\n        </li>`);return s.firstElementChild.addEventListener("click",(i=>{const o=e.querySelector("."+t);o!==r&&(e.querySelector("."+n).classList.remove(n),o.classList.remove(t),r.classList.add(t),i.target.classList.add(n))})),o||r.classList.add(t),s},o=e.querySelector("#principles__slider-js"),s=e.querySelectorAll(".principles__slide"),l=i('<ul class="principles__control list-reset"></ul>');s.forEach(((e,t)=>{e.classList.remove("principles__slide--no-js"),l.append(r(e,t))})),o.after(l)}})(),(()=>{const e=Array.from(document.querySelectorAll(".sort-panel__type")),t=Array.from(document.querySelectorAll(".sort-panel__direction")),n=n=>{const i=n.target;let r="",o=[];e.includes(i)?(r="sort-panel__type--active",o=e):(r="sort-panel__direction--active",o=t),o.filter((e=>e.classList.contains(r))).forEach((e=>e.classList.remove(r))),i.classList.add(r)};e.forEach((e=>e.addEventListener("click",n))),t.forEach((e=>e.addEventListener("click",n)))})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsIm11bHRpcGxlLXJhbmdlLmpzIiwicG9wdXAuanMiLCJzbGlkZXIuanMiLCJzb3J0LmpzIl0sIm5hbWVzIjpbIm1hcEltZ1dyYXBwZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbml0TWFwIiwibWFwIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsIk1hcmtlciIsInBvc2l0aW9uIiwiaWNvbiIsIm1hcENvbnRhaW5lciIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJwYXJlbnRFbGVtZW50IiwicmVwbGFjZUNoaWxkIiwic2NyaXB0Iiwic3JjIiwiZGVmZXIiLCJ3aW5kb3ciLCJoZWFkIiwiYXBwZW5kQ2hpbGQiLCJLZXlDb2RlIiwicHJldkVsZW1lbnQiLCJtaW5Db3N0IiwibWF4Q29zdCIsInJhbmdlQmxvY2siLCJ0ZW1wbGF0ZSIsIndyYXBwZXIiLCJpbm5lckhUTUwiLCJmaXJzdEVsZW1lbnRDaGlsZCIsInJhbmdlTGluZSIsInBvaW50TWluIiwicG9pbnRNYXgiLCJDb3N0T2JqIiwiTUlOIiwicHJvcE5hbWUiLCJsaW1pdENvc3RWYWx1ZSIsImxpbWl0UHJvcFZhbHVlIiwiaW5pdFByb3BWYWx1ZSIsImlucHV0IiwicG9pbnQiLCJNQVgiLCJnZXRDdXJyZW50UHJvcFZhbHVlIiwiY29zdE9iaiIsInBhcnNlRmxvYXQiLCJzdHlsZSIsImdldFByb3BlcnR5VmFsdWUiLCJzcGxpdCIsImNhbGN1bGF0ZVByb3BWYWx1ZSIsIm5ld0Nvc3RWYWx1ZSIsInBhcnNlSW50IiwidmFsdWUiLCJOdW1iZXIiLCJpc05hTiIsImNhbGN1bGF0ZUNvc3RWYWx1ZSIsImN1cnJlbnRQcm9wVmFsdWUiLCJNYXRoIiwicm91bmQiLCJjaGFuZ2VDb3N0VmFsdWUiLCJtYWtlU3luY2hyb25pemF0aW9uIiwibmV3UHJvcFZhbHVlIiwic2V0UHJvcGVydHkiLCJjaGFuZ2VQcm9wVmFsdWUiLCJvbkNoYW5nZUNvc3RWYWx1ZSIsImV2dCIsInRhcmdldCIsIm9uUG9pbnRNb3VzZURvd24iLCJkb3duRXZ0IiwibGluZVdpZHRoIiwiY2xpZW50V2lkdGgiLCJsZWZ0T2Zmc2V0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwibGVmdCIsIm9uTW92ZVBvaW50IiwibW91c2VFdnQiLCJ4Iiwib25VcFBvaW50IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJvblBvaW50S2V5RG93biIsImtleURvd25FdnQiLCJjb2RlIiwiYWZ0ZXIiLCJPUEVORURfQ0xBU1MiLCJFUlJPUl9DTEFTUyIsIm9wZW5Qb3B1cEJ0biIsInBvcHVwIiwicG9wdXBGb3JtIiwiY2xvc2VQb3B1cEJ0biIsInN1Ym1pdFBvcHVwRm9ybUJ0biIsIm5hbWVJbnB1dCIsImVtYWlsSW5wdXQiLCJsZXR0ZXJUZXh0YXJlYSIsIkxvY2FsU3RvcmFnZUtleSIsIk5BTUUiLCJFTUFJTCIsIm9wZW5Qb3B1cCIsInByZXZlbnREZWZhdWx0IiwiY2xhc3NMaXN0IiwiYWRkIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImNsb3NlUG9wdXAiLCJzdWJtaXRGb3JtIiwib25GaWVsZERhdGFDaGFuZ2VkIiwicmVtb3ZlIiwiaXNWYWxpZEZvcm1EYXRhIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiRm9ybURhdGEiLCJ0aGVuIiwicmVzcG9uc2UiLCJvayIsIkVycm9yIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsInNldEl0ZW0iLCJjYXRjaCIsImVycm9yIiwiaXNWYWxpZEZpZWxkIiwiZmllbGQiLCJsZW5ndGgiLCJzZXRDdXN0b21WYWxpZGl0eSIsInNsaWRlckNvbnRhaW5lciIsIlNMSURFX0FDVElWRV9DTEFTUyIsIkJVVFRPTl9BQ1RJVkVfQ0xBU1MiLCJuZXdFbGVtZW50IiwiZmlyc3RDaGlsZCIsImNyZWF0ZVNsaWRlckJ1dHRvbiIsInNsaWRlIiwibnVtYmVyIiwiYnV0dG9uV3JhcHBlciIsImN1cnJlbnRTbGlkZSIsImJlZm9yZUluc2VydEJsb2NrIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsImJ1dHRvbnNDb250YWluZXIiLCJmb3JFYWNoIiwiaW5kZXgiLCJhcHBlbmQiLCJzb3J0VHlwZUJ1dHRvbnMiLCJBcnJheSIsImZyb20iLCJzb3J0RGlyZWN0aW9uQnV0dG9ucyIsIm9uQnRuQ2xpY2siLCJzZWxlY3RlZEJ0biIsImFjdGl2ZUNsYXNzIiwiYnRucyIsImluY2x1ZGVzIiwiZmlsdGVyIiwiYnRuIiwiY29udGFpbnMiXSwibWFwcGluZ3MiOiJBQUFBLGFBRUEsTUFDQSxNQUFBQSxFQUFBQyxTQUFBQyxjQUFBLGtDQUVBQyxFQUFBLEtBRUEsTUFBQUMsRUFBQSxJQUFBQyxPQUFBQyxLQUFBQyxJQUFBTixTQUFBTyxlQUFBLE9BQUEsQ0FDQUMsS0FBQSxHQUNBQyxPQUFBLENBQ0FDLElBQUEsU0FDQUMsSUFBQSxZQUtBLElBQUFQLE9BQUFDLEtBQUFPLE9BQUEsQ0FDQUMsU0FBQSxDQUNBSCxJQUFBLFVBQ0FDLElBQUEsU0FFQVIsSUFBQUEsRUFDQVcsS0FBQSx5QkFJQSxHQUFBZixFQUFBLENBQ0EsTUFBQWdCLEVBQUFmLFNBQUFnQixjQUFBLE9BQ0FELEVBQUFFLGFBQUEsS0FBQSxPQUNBRixFQUFBRSxhQUFBLFFBQUEsa0JBQ0FsQixFQUFBbUIsY0FBQUMsYUFBQUosRUFBQWhCLEdBRUEsTUFBQXFCLEVBQUFwQixTQUFBZ0IsY0FBQSxVQUNBSSxFQUFBQyxJQUFBLHVHQUNBRCxFQUFBRSxPQUFBLEVBRUFDLE9BQUFyQixRQUFBQSxFQUVBRixTQUFBd0IsS0FBQUMsWUFBQUwsS0FwQ0EsR0NBQSxNQUNBLE1BQUFNLEVBQ0EsWUFEQUEsRUFFQSxhQUdBQyxFQUFBM0IsU0FBQUMsY0FBQSxnQ0FDQTJCLEVBQUE1QixTQUFBQyxjQUFBLGdCQUNBNEIsRUFBQTdCLFNBQUFDLGNBQUEsZ0JBU0EsR0FBQTBCLEdBQUFDLEdBQUFDLEVBQUEsQ0FDQSxNQWlCQUMsRUF6QkEs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cC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbigoKSA9PiB7XG4gIGNvbnN0IG1hcEltZ1dyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcGxhY2VtZW50X19pbWctbWFwLXdyYXBwZXItanNgKTtcblxuICBjb25zdCBpbml0TWFwID0gKCkgPT4ge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZlxuICAgIGNvbnN0IG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYG1hcGApLCB7XG4gICAgICB6b29tOiAxNyxcbiAgICAgIGNlbnRlcjoge1xuICAgICAgICBsYXQ6IDU5LjkzODk5MCxcbiAgICAgICAgbG5nOiAzMC4zMjE0NTAsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmLCBuby11bnVzZWQtdmFyc1xuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgbGF0OiA1OS45Mzg2MjgsXG4gICAgICAgIGxuZzogMzAuMzIzODAwLFxuICAgICAgfSxcbiAgICAgIG1hcCxcbiAgICAgIGljb246IGAvaW1nL21hcC1tYXJrZXIucG5nYCxcbiAgICB9KTtcbiAgfTtcblxuICBpZiAobWFwSW1nV3JhcHBlcikge1xuICAgIGNvbnN0IG1hcENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGRpdmApO1xuICAgIG1hcENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoYGlkYCwgYG1hcGApO1xuICAgIG1hcENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoYGNsYXNzYCwgYHBsYWNlbWVudF9fbWFwYCk7XG4gICAgbWFwSW1nV3JhcHBlci5wYXJlbnRFbGVtZW50LnJlcGxhY2VDaGlsZChtYXBDb250YWluZXIsIG1hcEltZ1dyYXBwZXIpO1xuXG4gICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgc2NyaXB0YCk7XG4gICAgc2NyaXB0LnNyYyA9IGBodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/a2V5PUFJemFTeURkeGlaOEpELUF3YzNWT2NoQWJrY0E1NC1YSFpKWWtHWSZjYWxsYmFjaz1pbml0TWFwYDtcbiAgICBzY3JpcHQuZGVmZXIgPSB0cnVlO1xuXG4gICAgd2luZG93LmluaXRNYXAgPSBpbml0TWFwO1xuXG4gICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICB9XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oKCkgPT4ge1xuICBjb25zdCBLZXlDb2RlID0ge1xuICAgIGxlZnQ6IGBBcnJvd0xlZnRgLFxuICAgIHJpZ2h0OiBgQXJyb3dSaWdodGAsXG4gIH07XG5cbiAgY29uc3QgcHJldkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjZmlsdGVyLXBhbmVsX19jb3N0LXRpdGxlLWpzYCk7XG4gIGNvbnN0IG1pbkNvc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY29zdC1taW4tanNgKTtcbiAgY29uc3QgbWF4Q29zdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNjb3N0LW1heC1qc2ApO1xuXG4gIGNvbnN0IGNyZWF0ZUVsZW1lbnQgPSAodGVtcGxhdGUpID0+IHtcbiAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XG4gICAgd3JhcHBlci5pbm5lckhUTUwgPSB0ZW1wbGF0ZTtcblxuICAgIHJldHVybiB3cmFwcGVyLmZpcnN0RWxlbWVudENoaWxkO1xuICB9O1xuXG4gIGlmIChwcmV2RWxlbWVudCAmJiBtaW5Db3N0ICYmIG1heENvc3QpIHtcbiAgICBjb25zdCBtYXJrdXAgPSAoYFxuICAgICAgPGRpdiBjbGFzcz1cImZpbHRlci1wYW5lbF9fY29zdC1yYW5nZVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZmlsdGVyLXBhbmVsX19jb3N0LXJhbmdlLWxpbmVcIj5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBjbGFzcz1cImZpbHRlci1wYW5lbF9fY29zdC1wb2ludCBmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQtLW1pblwiXG4gICAgICAgICAgICB0YWJpbmRleD1cIjBcIlxuICAgICAgICAgICAgaWQ9XCJmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQtbWluLWpzXCJcbiAgICAgICAgICA+PC9kaXY+XG4gICAgICAgICAgPGRpdlxuICAgICAgICAgICAgY2xhc3M9XCJmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQgZmlsdGVyLXBhbmVsX19jb3N0LXBvaW50LS1tYXhcIlxuICAgICAgICAgICAgdGFiaW5kZXg9XCIwXCJcbiAgICAgICAgICAgIGlkPVwiZmlsdGVyLXBhbmVsX19jb3N0LXBvaW50LW1heC1qc1wiXG4gICAgICAgICAgPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIGApO1xuXG4gICAgY29uc3QgcmFuZ2VCbG9jayA9IGNyZWF0ZUVsZW1lbnQobWFya3VwKTtcbiAgICBjb25zdCByYW5nZUxpbmUgPSByYW5nZUJsb2NrLnF1ZXJ5U2VsZWN0b3IoYC5maWx0ZXItcGFuZWxfX2Nvc3QtcmFuZ2UtbGluZWApO1xuICAgIGNvbnN0IHBvaW50TWluID0gcmFuZ2VCbG9jay5xdWVyeVNlbGVjdG9yKGAjZmlsdGVyLXBhbmVsX19jb3N0LXBvaW50LW1pbi1qc2ApO1xuICAgIGNvbnN0IHBvaW50TWF4ID0gcmFuZ2VCbG9jay5xdWVyeVNlbGVjdG9yKGAjZmlsdGVyLXBhbmVsX19jb3N0LXBvaW50LW1heC1qc2ApO1xuXG4gICAgY29uc3QgQ29zdE9iaiA9IHtcbiAgICAgIE1JTjoge1xuICAgICAgICBwcm9wTmFtZTogYC0tbWluLXBlcmNlbnRgLFxuICAgICAgICBsaW1pdENvc3RWYWx1ZTogMCxcbiAgICAgICAgbGltaXRQcm9wVmFsdWU6IDAsXG4gICAgICAgIGluaXRQcm9wVmFsdWU6IDAsXG4gICAgICAgIGlucHV0OiBtaW5Db3N0LFxuICAgICAgICBwb2ludDogcG9pbnRNaW4sXG4gICAgICB9LFxuICAgICAgTUFYOiB7XG4gICAgICAgIHByb3BOYW1lOiBgLS1tYXgtcGVyY2VudGAsXG4gICAgICAgIGxpbWl0Q29zdFZhbHVlOiAyMjA1OSxcbiAgICAgICAgbGltaXRQcm9wVmFsdWU6IDEwMCxcbiAgICAgICAgaW5pdFByb3BWYWx1ZTogNjgsXG4gICAgICAgIGlucHV0OiBtYXhDb3N0LFxuICAgICAgICBwb2ludDogcG9pbnRNYXgsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCBnZXRDdXJyZW50UHJvcFZhbHVlID0gKGNvc3RPYmopID0+IHtcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KFxuICAgICAgICAgIHJhbmdlQmxvY2suc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShjb3N0T2JqLnByb3BOYW1lKS5zcGxpdChgJWApWzBdXG4gICAgICApO1xuICAgIH07XG5cbiAgICBjb25zdCBjYWxjdWxhdGVQcm9wVmFsdWUgPSAoY29zdE9iaikgPT4ge1xuICAgICAgY29uc3QgbmV3Q29zdFZhbHVlID0gcGFyc2VJbnQoY29zdE9iai5pbnB1dC52YWx1ZSwgMTApO1xuXG4gICAgICBpZiAoTnVtYmVyLmlzTmFOKG5ld0Nvc3RWYWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGNvc3RPYmoubGltaXRQcm9wVmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXdDb3N0VmFsdWUgLyBDb3N0T2JqLk1BWC5saW1pdENvc3RWYWx1ZSAqIENvc3RPYmouTUFYLmxpbWl0UHJvcFZhbHVlO1xuICAgIH07XG5cbiAgICBjb25zdCBjYWxjdWxhdGVDb3N0VmFsdWUgPSAoY29zdE9iaikgPT4ge1xuICAgICAgY29uc3QgY3VycmVudFByb3BWYWx1ZSA9IGdldEN1cnJlbnRQcm9wVmFsdWUoY29zdE9iaik7XG5cbiAgICAgIHJldHVybiBNYXRoLnJvdW5kKFxuICAgICAgICAgIENvc3RPYmouTUFYLmxpbWl0Q29zdFZhbHVlICogY3VycmVudFByb3BWYWx1ZSAvIENvc3RPYmouTUFYLmxpbWl0UHJvcFZhbHVlXG4gICAgICApO1xuICAgIH07XG5cbiAgICBjb25zdCBjaGFuZ2VDb3N0VmFsdWUgPSAoY29zdE9iaikgPT4ge1xuICAgICAgY29uc3QgbmV3Q29zdFZhbHVlID0gY2FsY3VsYXRlQ29zdFZhbHVlKGNvc3RPYmopO1xuXG4gICAgICBpZiAocGFyc2VGbG9hdChjb3N0T2JqLmlucHV0LnZhbHVlKSAhPT0gbmV3Q29zdFZhbHVlKSB7XG4gICAgICAgIGNvc3RPYmouaW5wdXQudmFsdWUgPSBuZXdDb3N0VmFsdWU7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IG1ha2VTeW5jaHJvbml6YXRpb24gPSAoY29zdE9iaiwgbmV3UHJvcFZhbHVlKSA9PiB7XG4gICAgICByYW5nZUJsb2NrLnN0eWxlLnNldFByb3BlcnR5KGNvc3RPYmoucHJvcE5hbWUsIGAke25ld1Byb3BWYWx1ZX0lYCk7XG4gICAgICBjaGFuZ2VDb3N0VmFsdWUoY29zdE9iaik7XG4gICAgfTtcblxuICAgIGNvbnN0IGNoYW5nZVByb3BWYWx1ZSA9IChjb3N0T2JqLCBuZXdQcm9wVmFsdWUpID0+IHtcbiAgICAgIG5ld1Byb3BWYWx1ZSA9IG5ld1Byb3BWYWx1ZSA/IG5ld1Byb3BWYWx1ZSA6IGNhbGN1bGF0ZVByb3BWYWx1ZShjb3N0T2JqKTtcblxuICAgICAgaWYgKG5ld1Byb3BWYWx1ZSA8IENvc3RPYmouTUlOLmxpbWl0UHJvcFZhbHVlKSB7XG4gICAgICAgIG5ld1Byb3BWYWx1ZSA9IENvc3RPYmouTUlOLmxpbWl0UHJvcFZhbHVlO1xuICAgICAgfSBlbHNlIGlmIChuZXdQcm9wVmFsdWUgPiBDb3N0T2JqLk1BWC5saW1pdFByb3BWYWx1ZSkge1xuICAgICAgICBuZXdQcm9wVmFsdWUgPSBDb3N0T2JqLk1BWC5saW1pdFByb3BWYWx1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNvc3RPYmogPT09IENvc3RPYmouTUlOICYmIG5ld1Byb3BWYWx1ZSA+IGdldEN1cnJlbnRQcm9wVmFsdWUoQ29zdE9iai5NQVgpKSB7XG4gICAgICAgIG1ha2VTeW5jaHJvbml6YXRpb24oQ29zdE9iai5NQVgsIG5ld1Byb3BWYWx1ZSk7XG4gICAgICB9IGVsc2UgaWYgKGNvc3RPYmogPT09IENvc3RPYmouTUFYICYmIG5ld1Byb3BWYWx1ZSA8IGdldEN1cnJlbnRQcm9wVmFsdWUoQ29zdE9iai5NSU4pKSB7XG4gICAgICAgIG1ha2VTeW5jaHJvbml6YXRpb24oQ29zdE9iai5NSU4sIG5ld1Byb3BWYWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIG1ha2VTeW5jaHJvbml6YXRpb24oY29zdE9iaiwgbmV3UHJvcFZhbHVlKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25DaGFuZ2VDb3N0VmFsdWUgPSAoZXZ0KSA9PiB7XG4gICAgICBpZiAoZXZ0LnRhcmdldCA9PT0gQ29zdE9iai5NSU4uaW5wdXQpIHtcbiAgICAgICAgY2hhbmdlUHJvcFZhbHVlKENvc3RPYmouTUlOKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNoYW5nZVByb3BWYWx1ZShDb3N0T2JqLk1BWCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IG9uUG9pbnRNb3VzZURvd24gPSAoZG93bkV2dCkgPT4ge1xuICAgICAgY29uc3QgY29zdE9iaiA9IGRvd25FdnQudGFyZ2V0ID09PSBDb3N0T2JqLk1JTi5wb2ludFxuICAgICAgICA/IENvc3RPYmouTUlOXG4gICAgICAgIDogQ29zdE9iai5NQVg7XG4gICAgICBjb25zdCBsaW5lV2lkdGggPSByYW5nZUxpbmUuY2xpZW50V2lkdGg7XG4gICAgICBjb25zdCBsZWZ0T2Zmc2V0ID0gcmFuZ2VMaW5lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG5cbiAgICAgIGNvbnN0IG9uTW92ZVBvaW50ID0gKG1vdXNlRXZ0KSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld1Byb3BWYWx1ZSA9IE1hdGgucm91bmQoKG1vdXNlRXZ0LnggLSBsZWZ0T2Zmc2V0KSAvIGxpbmVXaWR0aCAqIDEwMCk7XG5cbiAgICAgICAgY2hhbmdlUHJvcFZhbHVlKGNvc3RPYmosIG5ld1Byb3BWYWx1ZSk7XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBvblVwUG9pbnQgPSAoKSA9PiB7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoYG1vdXNlbW92ZWAsIG9uTW92ZVBvaW50KTtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihgbW91c2V1cGAsIG9uVXBQb2ludCk7XG4gICAgICB9O1xuXG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKGBtb3VzZW1vdmVgLCBvbk1vdmVQb2ludCk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKGBtb3VzZXVwYCwgb25VcFBvaW50KTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25Qb2ludEtleURvd24gPSAoa2V5RG93bkV2dCkgPT4ge1xuICAgICAgY29uc3QgY29zdE9iaiA9IGtleURvd25FdnQudGFyZ2V0ID09PSBDb3N0T2JqLk1JTi5wb2ludFxuICAgICAgICA/IENvc3RPYmouTUlOXG4gICAgICAgIDogQ29zdE9iai5NQVg7XG5cbiAgICAgIGlmIChrZXlEb3duRXZ0LmNvZGUgPT09IEtleUNvZGUubGVmdCkge1xuICAgICAgICBjaGFuZ2VQcm9wVmFsdWUoY29zdE9iaiwgZ2V0Q3VycmVudFByb3BWYWx1ZShjb3N0T2JqKSAtIDEpO1xuICAgICAgfSBlbHNlIGlmIChrZXlEb3duRXZ0LmNvZGUgPT09IEtleUNvZGUucmlnaHQpIHtcbiAgICAgICAgY2hhbmdlUHJvcFZhbHVlKGNvc3RPYmosIGdldEN1cnJlbnRQcm9wVmFsdWUoY29zdE9iaikgKyAxKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgbWFrZVN5bmNocm9uaXphdGlvbihDb3N0T2JqLk1JTiwgQ29zdE9iai5NSU4uaW5pdFByb3BWYWx1ZSk7XG4gICAgbWFrZVN5bmNocm9uaXphdGlvbihDb3N0T2JqLk1BWCwgQ29zdE9iai5NQVguaW5pdFByb3BWYWx1ZSk7XG5cbiAgICBtaW5Db3N0LmFkZEV2ZW50TGlzdGVuZXIoYGlucHV0YCwgb25DaGFuZ2VDb3N0VmFsdWUpO1xuICAgIG1heENvc3QuYWRkRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCBvbkNoYW5nZUNvc3RWYWx1ZSk7XG5cbiAgICBwb2ludE1pbi5hZGRFdmVudExpc3RlbmVyKGBtb3VzZWRvd25gLCBvblBvaW50TW91c2VEb3duKTtcbiAgICBwb2ludE1heC5hZGRFdmVudExpc3RlbmVyKGBtb3VzZWRvd25gLCBvblBvaW50TW91c2VEb3duKTtcblxuICAgIHBvaW50TWluLmFkZEV2ZW50TGlzdGVuZXIoYGtleWRvd25gLCBvblBvaW50S2V5RG93bik7XG4gICAgcG9pbnRNYXguYWRkRXZlbnRMaXN0ZW5lcihga2V5ZG93bmAsIG9uUG9pbnRLZXlEb3duKTtcblxuICAgIHByZXZFbGVtZW50LmFmdGVyKHJhbmdlQmxvY2spO1xuICB9XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oKCkgPT4ge1xuICBjb25zdCBPUEVORURfQ0xBU1MgPSBgcG9wdXAtLW9wZW5lZGA7XG4gIGNvbnN0IE5PX0pTX0NMQVNTID0gYHBvcHVwLS1uby1qc2A7XG4gIGNvbnN0IEVSUk9SX0NMQVNTID0gYHBvcHVwLS1lcnJvcmA7XG4gIGNvbnN0IEVSUk9SX01FU1NBR0UgPSBg0J7QsdGP0LfQsNGC0LXQu9GM0L3QvtC1INC/0L7Qu9C1INC00LvRjyDQt9Cw0L/QvtC70L3QtdC90LjRj2A7XG4gIGNvbnN0IFVSTCA9IGBodHRwczovL2VjaG8uaHRtbGFjYWRlbXkucnUvYDtcblxuICBjb25zdCBvcGVuUG9wdXBCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcGxhY2VtZW50X19kZXNjcmlwdGlvbi1idXR0b24tanNgKTtcbiAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcG9wdXAtanNgKTtcbiAgY29uc3QgcG9wdXBGb3JtID0gcG9wdXAucXVlcnlTZWxlY3RvcihgI3BvcHVwX19mb3JtLWpzYCk7XG4gIGNvbnN0IGNsb3NlUG9wdXBCdG4gPSBwb3B1cC5xdWVyeVNlbGVjdG9yKGAjcG9wdXBfX2Nsb3NlLWJ1dHRvbi1qc2ApO1xuICBjb25zdCBzdWJtaXRQb3B1cEZvcm1CdG4gPSBwb3B1cC5xdWVyeVNlbGVjdG9yKGAjcG9wdXBfX3N1Ym1pdC1qc2ApO1xuICBjb25zdCBuYW1lSW5wdXQgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKGAjcG9wdXAtZmllbGQtbmFtZS1qc2ApO1xuICBjb25zdCBlbWFpbElucHV0ID0gcG9wdXAucXVlcnlTZWxlY3RvcihgI3BvcHVwLWZpZWxkLWVtYWlsLWpzYCk7XG4gIGNvbnN0IGxldHRlclRleHRhcmVhID0gcG9wdXAucXVlcnlTZWxlY3RvcihgI3BvcHVwLWZpZWxkLWxldHRlci1qc2ApO1xuXG4gIGNvbnN0IExvY2FsU3RvcmFnZUtleSA9IHtcbiAgICBOQU1FOiBgdXNlck5hbWVgLFxuICAgIEVNQUlMOiBgdXNlckVtYWlsYCxcbiAgfTtcblxuICBjb25zdCBvcGVuUG9wdXAgPSAoZXZ0KSA9PiB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKE9QRU5FRF9DTEFTUyk7XG5cbiAgICBuYW1lSW5wdXQudmFsdWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShMb2NhbFN0b3JhZ2VLZXkuTkFNRSk7XG4gICAgZW1haWxJbnB1dC52YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKExvY2FsU3RvcmFnZUtleS5FTUFJTCk7XG5cbiAgICBjbG9zZVBvcHVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgY2xvc2VQb3B1cCk7XG4gICAgc3VibWl0UG9wdXBGb3JtQnRuLmFkZEV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgc3VibWl0Rm9ybSk7XG4gICAgbmFtZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoYGlucHV0YCwgb25GaWVsZERhdGFDaGFuZ2VkKTtcbiAgICBlbWFpbElucHV0LmFkZEV2ZW50TGlzdGVuZXIoYGlucHV0YCwgb25GaWVsZERhdGFDaGFuZ2VkKTtcbiAgICBsZXR0ZXJUZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsIG9uRmllbGREYXRhQ2hhbmdlZCk7XG4gIH07XG5cbiAgY29uc3QgY2xvc2VQb3B1cCA9IChldnQpID0+IHtcbiAgICBpZiAoZXZ0KSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKE9QRU5FRF9DTEFTUyk7XG4gICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShFUlJPUl9DTEFTUyk7XG5cbiAgICBjbG9zZVBvcHVwQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgY2xvc2VQb3B1cCk7XG4gICAgc3VibWl0UG9wdXBGb3JtQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgc3VibWl0Rm9ybSk7XG4gICAgbmFtZUlucHV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoYGlucHV0YCwgb25GaWVsZERhdGFDaGFuZ2VkKTtcbiAgICBlbWFpbElucHV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoYGlucHV0YCwgb25GaWVsZERhdGFDaGFuZ2VkKTtcbiAgICBsZXR0ZXJUZXh0YXJlYS5yZW1vdmVFdmVudExpc3RlbmVyKGBpbnB1dGAsIG9uRmllbGREYXRhQ2hhbmdlZCk7XG4gIH07XG5cbiAgY29uc3QgY2xlYXJQb3B1cCA9ICgpID0+IHtcbiAgICBuYW1lSW5wdXQudmFsdWUgPSBgYDtcbiAgICBlbWFpbElucHV0LnZhbHVlID0gYGA7XG4gICAgbGV0dGVyVGV4dGFyZWEudmFsdWUgPSBgYDtcbiAgfTtcblxuICBjb25zdCBzdWJtaXRGb3JtID0gKGV2dCkgPT4ge1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShFUlJPUl9DTEFTUyk7XG5cbiAgICBpZiAoaXNWYWxpZEZvcm1EYXRhKCkpIHtcbiAgICAgIGZldGNoKFVSTCwge1xuICAgICAgICBtZXRob2Q6IGBQT1NUYCxcbiAgICAgICAgYm9keTogbmV3IEZvcm1EYXRhKHBvcHVwRm9ybSksXG4gICAgICB9KVxuICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKEVSUk9SX0NMQVNTKTtcblxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBfJHtyZXNwb25zZS5zdGF0dXN9OiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oTG9jYWxTdG9yYWdlS2V5Lk5BTUUsIG5hbWVJbnB1dC52YWx1ZSk7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oTG9jYWxTdG9yYWdlS2V5LkVNQUlMLCBlbWFpbElucHV0LnZhbHVlKTtcblxuICAgICAgICAgIGNsZWFyUG9wdXAoKTtcbiAgICAgICAgICBjbG9zZVBvcHVwKCk7XG5cbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKEVSUk9SX0NMQVNTKTtcblxuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgaXNWYWxpZEZpZWxkID0gKGZpZWxkKSA9PiB7XG4gICAgaWYgKGZpZWxkLnZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgIGZpZWxkLnNldEN1c3RvbVZhbGlkaXR5KGBgKTtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZmllbGQuc2V0Q3VzdG9tVmFsaWRpdHkoRVJST1JfTUVTU0FHRSk7XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgY29uc3QgaXNWYWxpZEZvcm1EYXRhID0gKCkgPT4ge1xuICAgIHJldHVybiBpc1ZhbGlkRmllbGQobmFtZUlucHV0KVxuICAgICAgJiYgaXNWYWxpZEZpZWxkKGVtYWlsSW5wdXQpXG4gICAgICAmJiBpc1ZhbGlkRmllbGQobGV0dGVyVGV4dGFyZWEpO1xuICB9O1xuXG4gIGNvbnN0IG9uRmllbGREYXRhQ2hhbmdlZCA9IChldnQpID0+IHtcbiAgICBpc1ZhbGlkRmllbGQoZXZ0LnRhcmdldCk7XG4gIH07XG5cbiAgaWYgKHBvcHVwICYmIG9wZW5Qb3B1cEJ0biAmJiBjbG9zZVBvcHVwQnRuICYmIHN1Ym1pdFBvcHVwRm9ybUJ0bikge1xuICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoTk9fSlNfQ0xBU1MpO1xuICAgIG9wZW5Qb3B1cEJ0bi5hZGRFdmVudExpc3RlbmVyKGBjbGlja2AsIG9wZW5Qb3B1cCk7XG4gIH1cbn0pKCk7XG4iLCIndXNlIHN0cmljdCc7XG5cbigoKSA9PiB7XG4gIGNvbnN0IHNsaWRlckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5wcmluY2lwbGVzYCk7XG5cbiAgaWYgKHNsaWRlckNvbnRhaW5lcikge1xuICAgIGNvbnN0IFNMSURFX0FDVElWRV9DTEFTUyA9IGBwcmluY2lwbGVzX19zbGlkZS0tYWN0aXZlYDtcbiAgICBjb25zdCBCVVRUT05fQUNUSVZFX0NMQVNTID0gYHByaW5jaXBsZXNfX2NvbnRyb2wtYnV0dG9uLS1hY3RpdmVgO1xuXG4gICAgY29uc3QgY3JlYXRlRWxlbWVudCA9ICh0ZW1wbGF0ZSkgPT4ge1xuICAgICAgY29uc3QgbmV3RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGRpdmApO1xuICAgICAgbmV3RWxlbWVudC5pbm5lckhUTUwgPSB0ZW1wbGF0ZTtcblxuICAgICAgcmV0dXJuIG5ld0VsZW1lbnQuZmlyc3RDaGlsZDtcbiAgICB9O1xuXG4gICAgY29uc3QgY3JlYXRlU2xpZGVyQnV0dG9uID0gKHNsaWRlLCBudW1iZXIpID0+IHtcbiAgICAgIGNvbnN0IGJ1dHRvblRlbXBsYXRlID0gKFxuICAgICAgICBgPGxpPlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJwcmluY2lwbGVzX19jb250cm9sLWJ1dHRvbiAgJHtudW1iZXIgPyBgYCA6IEJVVFRPTl9BQ1RJVkVfQ0xBU1N9XCIgdHlwZT1cImJ1dHRvblwiPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ2aXN1YWxseS1oaWRkZW5cIj7Qn9GA0LjQvdGG0LjQvyAke251bWJlciArIDF9PC9zcGFuPlxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2xpPmBcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGJ1dHRvbldyYXBwZXIgPSBjcmVhdGVFbGVtZW50KGJ1dHRvblRlbXBsYXRlKTtcbiAgICAgIGJ1dHRvbldyYXBwZXIuZmlyc3RFbGVtZW50Q2hpbGQuYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoZXZ0KSA9PiB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRTbGlkZSA9IHNsaWRlckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKGAuJHtTTElERV9BQ1RJVkVfQ0xBU1N9YCk7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRTbGlkZSAhPT0gc2xpZGUpIHtcbiAgICAgICAgICBzbGlkZXJDb250YWluZXIucXVlcnlTZWxlY3RvcihgLiR7QlVUVE9OX0FDVElWRV9DTEFTU31gKVxuICAgICAgICAgICAgLmNsYXNzTGlzdC5yZW1vdmUoQlVUVE9OX0FDVElWRV9DTEFTUyk7XG4gICAgICAgICAgY3VycmVudFNsaWRlLmNsYXNzTGlzdC5yZW1vdmUoU0xJREVfQUNUSVZFX0NMQVNTKTtcblxuICAgICAgICAgIHNsaWRlLmNsYXNzTGlzdC5hZGQoU0xJREVfQUNUSVZFX0NMQVNTKTtcbiAgICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoQlVUVE9OX0FDVElWRV9DTEFTUyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIW51bWJlcikge1xuICAgICAgICBzbGlkZS5jbGFzc0xpc3QuYWRkKFNMSURFX0FDVElWRV9DTEFTUyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBidXR0b25XcmFwcGVyO1xuICAgIH07XG5cbiAgICBjb25zdCBiZWZvcmVJbnNlcnRCbG9jayA9IHNsaWRlckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKGAjcHJpbmNpcGxlc19fc2xpZGVyLWpzYCk7XG4gICAgY29uc3Qgc2xpZGVzID0gc2xpZGVyQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoYC5wcmluY2lwbGVzX19zbGlkZWApO1xuXG4gICAgY29uc3QgYnV0dG9uc0NvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoYDx1bCBjbGFzcz1cInByaW5jaXBsZXNfX2NvbnRyb2wgbGlzdC1yZXNldFwiPjwvdWw+YCk7XG5cbiAgICBzbGlkZXMuZm9yRWFjaCgoc2xpZGUsIGluZGV4KSA9PiB7XG4gICAgICBzbGlkZS5jbGFzc0xpc3QucmVtb3ZlKGBwcmluY2lwbGVzX19zbGlkZS0tbm8tanNgKTtcblxuICAgICAgYnV0dG9uc0NvbnRhaW5lci5hcHBlbmQoY3JlYXRlU2xpZGVyQnV0dG9uKHNsaWRlLCBpbmRleCkpO1xuICAgIH0pO1xuXG5cbiAgICBiZWZvcmVJbnNlcnRCbG9jay5hZnRlcihidXR0b25zQ29udGFpbmVyKTtcbiAgfVxufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuKCgpID0+IHtcbiAgY29uc3QgQUNUSVZFX1NPUlRfVFlQRV9DTEFTUyA9IGBzb3J0LXBhbmVsX190eXBlLS1hY3RpdmVgO1xuICBjb25zdCBBQ1RJVkVfU09SVF9ESVJFQ1RJT05fQ0xBU1MgPSBgc29ydC1wYW5lbF9fZGlyZWN0aW9uLS1hY3RpdmVgO1xuXG4gIGNvbnN0IHNvcnRUeXBlQnV0dG9ucyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLnNvcnQtcGFuZWxfX3R5cGVgKSk7XG4gIGNvbnN0IHNvcnREaXJlY3Rpb25CdXR0b25zID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAuc29ydC1wYW5lbF9fZGlyZWN0aW9uYCkpO1xuXG4gIGNvbnN0IG9uQnRuQ2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0ZWRCdG4gPSBldnQudGFyZ2V0O1xuICAgIGxldCBhY3RpdmVDbGFzcyA9IGBgO1xuICAgIGxldCBidG5zID0gW107XG5cbiAgICBpZiAoc29ydFR5cGVCdXR0b25zLmluY2x1ZGVzKHNlbGVjdGVkQnRuKSkge1xuICAgICAgYWN0aXZlQ2xhc3MgPSBBQ1RJVkVfU09SVF9UWVBFX0NMQVNTO1xuICAgICAgYnRucyA9IHNvcnRUeXBlQnV0dG9ucztcbiAgICB9IGVsc2Uge1xuICAgICAgYWN0aXZlQ2xhc3MgPSBBQ1RJVkVfU09SVF9ESVJFQ1RJT05fQ0xBU1M7XG4gICAgICBidG5zID0gc29ydERpcmVjdGlvbkJ1dHRvbnM7XG4gICAgfVxuXG4gICAgYnRuc1xuICAgICAgLmZpbHRlcigoYnRuKSA9PiBidG4uY2xhc3NMaXN0LmNvbnRhaW5zKGFjdGl2ZUNsYXNzKSlcbiAgICAgIC5mb3JFYWNoKChidG4pID0+IGJ0bi5jbGFzc0xpc3QucmVtb3ZlKGFjdGl2ZUNsYXNzKSk7XG5cbiAgICBzZWxlY3RlZEJ0bi5jbGFzc0xpc3QuYWRkKGFjdGl2ZUNsYXNzKTtcbiAgfTtcblxuICBzb3J0VHlwZUJ1dHRvbnMuZm9yRWFjaCgoYnRuKSA9PiBidG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBvbkJ0bkNsaWNrKSk7XG4gIHNvcnREaXJlY3Rpb25CdXR0b25zLmZvckVhY2goKGJ0bikgPT4gYnRuLmFkZEV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgb25CdG5DbGljaykpO1xufSkoKTtcbiJdfQ==
